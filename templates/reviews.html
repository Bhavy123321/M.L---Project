{% extends "base.html" %}
{% set title = brand_name ~ " • Reviews" %}

{% block content %}
<section class="heroWrap">
  <div class="container">
    <div class="row g-4">

      <div class="col-lg-5">
        <div class="glassCard">
          <div class="pill">Reviews</div>
          <h2 class="heroTitle mt-2">Leave a Review</h2>
          <p class="heroText">Make your project look more real and trustworthy.</p>

          {% if page_error %}
            <div class="alert alert-warning">
              <b>Note:</b> Reviews page had an issue but it’s now recovered.<br>
              <span class="small text-soft">{{ page_error }}</span>
            </div>
          {% endif %}

          <div class="ratingSummary">
            <div class="ratingBig">{{ avg_rating if avg_rating is not none else 0 }}</div>
            <div>
              <div class="ratingStars">
                {% set full = (avg_rating|int) if avg_rating is not none else 0 %}
                {% for _ in range(full) %}★{% endfor %}
                {% for _ in range(5-full) %}☆{% endfor %}
              </div>
              <div class="text-soft small">{{ total_reviews if total_reviews is not none else 0 }} total reviews</div>
            </div>
          </div>

          <form action="/reviews" method="POST" class="mt-3">
            <div class="mb-3">
              <label class="form-label">Your Name</label>
              <input class="form-control form-control-lg" name="name" placeholder="e.g. Bhavy" />
            </div>

            <div class="mb-3">
              <label class="form-label">Tag</label>
              <input class="form-control form-control-lg" name="tag" placeholder="e.g. Student / Teacher" />
            </div>

            <div class="mb-3">
              <label class="form-label">Rating</label>
              <select class="form-select form-select-lg" name="rating">
                <option value="5" selected>★★★★★ (5)</option>
                <option value="4">★★★★☆ (4)</option>
                <option value="3">★★★☆☆ (3)</option>
                <option value="2">★★☆☆☆ (2)</option>
                <option value="1">★☆☆☆☆ (1)</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Message</label>
              <textarea class="form-control form-control-lg" name="message" rows="4"
                        placeholder="Write your feedback..."></textarea>
            </div>

            <div class="d-grid">
              <button class="btn btnGlow btn-lg">
                Submit Review
                <span class="btnShine"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="col-lg-7">
        <div class="glassCard">
          <div class="cardTitle">What people say</div>
          <div class="cardSub">Latest reviews shown first</div>

          <div class="divider"></div>

          <div class="reviewGrid">
            {% if reviews and reviews|length > 0 %}
              {% for r in reviews %}
                <div class="reviewCard">
                  <div class="reviewTop">
                    <div>
                      <div class="reviewName">{{ r.name if r.name else "Anonymous" }}</div>
                      <div class="reviewTag text-soft">{{ r.tag if r.tag else "User" }} • {{ r.date if r.date else "" }}</div>
                    </div>
                    <div class="reviewStars">
                      {% set rr = r.rating if r.rating is not none else 5 %}
                      {% for _ in range(rr) %}★{% endfor %}
                      {% for _ in range(5-rr) %}☆{% endfor %}
                    </div>
                  </div>
                  <div class="reviewMsg">{{ r.message if r.message else "Great project!" }}</div>
                </div>
              {% endfor %}
            {% else %}
              <div class="text-soft">No reviews yet. Be the first!</div>
            {% endif %}
          </div>

        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}
